define("discourse/plugins/discourse-templates/components/template-item",["exports","@ember/component","@ember/object","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-templates/lib/apply-template"],(function(e,t,i,s,l,o){"use strict"
var a
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var r,n,c,d,u,p,m=t.default.extend((r=a={classNames:["templates-template-item"],apply(){const e=(0,o.prepareTemplate)(this.template.title,this.template.content,this.model)
this.onInsertTemplate?.(e),(0,s.ajax)(`/discourse_templates/${this.template.id}/use`,{type:"POST"}).catch(l.popupAjaxError)}},n="apply",c=[i.action],d=Object.getOwnPropertyDescriptor(a,"apply"),u=a,p={},Object.keys(d).forEach((function(e){p[e]=d[e]})),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=c.slice().reverse().reduce((function(e,t){return t(r,n,e)||e}),p),u&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(u):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(r,n,p),p=null),a))
e.default=m})),define("discourse/plugins/discourse-templates/components/templates-filterable-list",["exports","@ember/component","@ember/object","@ember/runloop","discourse/lib/ajax","discourse/lib/ajax-error","discourse/mixins/textarea-text-manipulation","discourse-common/utils/decorators","select-kit/components/tag-drop","discourse/plugins/discourse-templates/lib/apply-template"],(function(e,t,i,s,l,o,a,r,n,c){"use strict"
var d
function u(e,t,i,s,l){var o={}
return Object.keys(s).forEach((function(e){o[e]=s[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),o),l&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(l):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var p=t.default.extend(a.default,(d={classNames:["templates-filterable-list"],init(){this._super(...arguments),this.setProperties({loadingReplies:!1,listFilter:"",replies:[],selectedTag:n.ALL_TAGS_ID,availableTags:[],_textarea:null,ready:!1})},didInsertElement(){this._load()},filteredReplies(e,t,i){const s=i.toLowerCase()
return e.map((e=>(e.score=0,e.title.toLowerCase().includes(s)?e.score+=2:e.content.toLowerCase().includes(s)&&(e.score+=1),e))).filter((e=>0!==e.score)).filter((e=>t===n.ALL_TAGS_ID||(t===n.NO_TAG_ID&&0===e.tags.length||e.tags.includes(t)))).sort(((e,t)=>e.score!==t.score?e.score>t.score?-1:1:e.title!==t.title?e.title<t.title?-1:1:0))},changeSelectedTag(e){this.set("selectedTag",e)},insertTemplate(e){this._textarea=this.textarea,this.onBeforeInsertTemplate?.(),this._textarea?this._addBlock(this.getSelected(),e.templateContent):(0,c.insertTemplateIntoComposer)(this,e),this.onAfterInsertTemplate?.()},_load(){(0,l.ajax)("/discourse_templates").then((e=>{this.setProperties({ready:!0,replies:e.templates,availableTags:this.siteSettings.tagging_enabled?Object.values(e.templates.reduce(((e,t)=>(t.tags.forEach((t=>{e[t]?e[t].count+=1:e[t]={id:t,name:t,count:1}})),e)),{})):[]})})).catch(o.popupAjaxError).finally((()=>{this.set("loadingReplies",!1),(0,s.schedule)("afterRender",(()=>document.querySelector(".templates-filter")?.focus()))}))}},u(d,"filteredReplies",[(0,r.default)("replies","selectedTag","listFilter")],Object.getOwnPropertyDescriptor(d,"filteredReplies"),d),u(d,"changeSelectedTag",[i.action],Object.getOwnPropertyDescriptor(d,"changeSelectedTag"),d),u(d,"insertTemplate",[i.action],Object.getOwnPropertyDescriptor(d,"insertTemplate"),d),d))
e.default=p})),define("discourse/plugins/discourse-templates/components/templates-form",["exports","@ember/component"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=t.default.extend({})
e.default=i})),define("discourse/plugins/discourse-templates/components/templates-tag-drop",["exports","discourse-common/utils/decorators","select-kit/components/tag-drop"],(function(e,t,i){"use strict"
var s,l
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var o,a,r,n,c,d,u=i.default.extend((s=(0,t.default)("availableTags.[]"),o=l={topTags:e=>(e||[]).sort(((e,t)=>e.count!==t.count?t.count-e.count:e.name!==t.name?e.name<t.name?-1:1:0)),search(e){return(this.content||[]).map((e=>e.id&&e.name?e:this.defaultItem(e,e))).filter((t=>{if(null==e)return!0
const i=e.toLowerCase()
return t.id.toLowerCase().includes(i)||t.name.toLowerCase().includes(i)}))},actions:{onChange(e,t){this.onChange&&this.onChange(e,t)}}},a="topTags",r=[s],n=Object.getOwnPropertyDescriptor(l,"topTags"),c=l,d={},Object.keys(n).forEach((function(e){d[e]=n[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=r.slice().reverse().reduce((function(e,t){return t(o,a,e)||e}),d),c&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(c):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(o,a,d),d=null),l))
e.default=u})),define("discourse/plugins/discourse-templates/connectors/above-modal-header/discourse-templates-modal-hijacker",["exports","@ember/object","discourse-common/lib/get-owner"],(function(e,t,i){"use strict"
var s
function l(e,t,i,s,l){var o={}
return Object.keys(s).forEach((function(e){o[e]=s[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),o),l&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(l):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var o=(l(s={setupComponent(e,t){t.setProperties({active:!1,model:(0,i.getOwner)(this).lookup("controller:composer").model,displayMap:new WeakMap}),this.appEvents.on("discourse-templates:hijack-modal",this,"show"),this.appEvents.on("discourse-templates:restore-modal",this,"hide"),this.appEvents.on("modal:body-dismissed",this,"hide")},teardownComponent(){this.appEvents.off("discourse-templates:hijack-modal",this,"show"),this.appEvents.off("discourse-templates:restore-modal",this,"hide"),this.appEvents.off("modal:body-dismissed",this,"hide")},show(e){let{textarea:t}=e
const i=document.querySelector(".modal-inner-container")
t&&(this.set("active",!0),this.set("textarea",t),Array.from(i.children).forEach((e=>{e!==this.element&&(this.displayMap.set(e,e.style.display),e.style.display="none")})))},hide(){this.set("active",!1)
const e=document.querySelector(".modal-inner-container")
Array.from(e.children).forEach((e=>{const t=this.displayMap.get(e)
null!=t&&(this.displayMap.delete(e),e.style.display=t)}))}},"show",[t.action],Object.getOwnPropertyDescriptor(s,"show"),s),l(s,"hide",[t.action],Object.getOwnPropertyDescriptor(s,"hide"),s),s)
e.default=o})),define("discourse/plugins/discourse-templates/connectors/editor-preview/discourse-templates",["exports","@ember/object","discourse-common/lib/get-owner"],(function(e,t,i){"use strict"
var s
function l(e,t,i,s,l){var o={}
return Object.keys(s).forEach((function(e){o[e]=s[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),o),l&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(l):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o="#reply-control .d-editor-preview-wrapper > .d-editor-preview"
var a=(l(s={setupComponent(e,t){t.setProperties({templatesVisible:!1,model:(0,i.getOwner)(this).lookup("controller:composer").model}),this.appEvents.on("discourse-templates:show",this,"show"),this.appEvents.on("discourse-templates:hide",this,"hide")},teardownComponent(){this.appEvents.off("discourse-templates:show",this,"show"),this.appEvents.off("discourse-templates:hide",this,"hide")},shouldRender:(e,t)=>!t.site.mobileView,show(){const e=document.querySelector(o)
e&&(e.style.display="none"),this.set("templatesVisible",!0)},hide(){const e=document.querySelector(o)
e&&(e.style.display=""),this.set("templatesVisible",!1)}},"show",[t.action],Object.getOwnPropertyDescriptor(s,"show"),s),l(s,"hide",[t.action],Object.getOwnPropertyDescriptor(s,"hide"),s),s)
e.default=a})),define("discourse/plugins/discourse-templates/controllers/discourse-templates-modal",["exports","@ember/controller","@ember/object","discourse-common/lib/get-owner","discourse/mixins/modal-functionality"],(function(e,t,i,s,l){"use strict"
var o
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a,r,n,c,d,u,p=t.default.extend(l.default,(o={init(){this._super(...arguments),this.set("model",(0,s.getOwner)(this).lookup("controller:composer").model)},hide(){this.send("closeModal"),this.textarea=null}},a=o,r="hide",n=[i.action],c=Object.getOwnPropertyDescriptor(o,"hide"),d=o,u={},Object.keys(c).forEach((function(e){u[e]=c[e]})),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=n.slice().reverse().reduce((function(e,t){return t(a,r,e)||e}),u),d&&void 0!==u.initializer&&(u.value=u.initializer?u.initializer.call(d):void 0,u.initializer=void 0),void 0===u.initializer&&(Object.defineProperty(a,r,u),u=null),o))
e.default=p})),define("discourse/plugins/discourse-templates/discourse/templates/components/template-item",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=(0,t.createTemplateFactory)({id:"Z0R52dEj",block:'[[[10,"details"],[14,0,"template-item"],[15,1,[29,["template-item-",[33,0,["id"]]]]],[12],[1,"\\n  "],[10,"summary"],[14,0,"template-item-title"],[12],[1,"\\n    "],[10,0],[14,0,"template-item-title-text"],[12],[1,[33,0,["title"]]],[13],[1,"\\n\\n    "],[10,0],[14,0,"actions"],[12],[1,"\\n      "],[1,[28,[35,1],null,[["class","action","icon"],["templates-apply",[28,[37,2],[[30,0],"apply"],null],"far-clipboard"]]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"templates-content"],[12],[1,"\\n    "],[1,[28,[35,3],[[33,0,["content"]]],null]],[1,"\\n  "],[13],[1,"\\n"],[13],[1,"\\n"]],[],false,["template","d-button","action","cook-text"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/components/template-item.hbs",isStrictMode:!1})
e.default=i})),define("discourse/plugins/discourse-templates/discourse/templates/components/templates-filterable-list",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=(0,t.createTemplateFactory)({id:"xj28h8kb",block:'[[[6,[39,0],null,[["condition"],[[33,1]]],[["default"],[[[[1,"  "],[10,0],[14,0,"templates-filter-bar"],[12],[1,"\\n"],[41,[33,3,["tagging_enabled"]],[[[1,"      "],[1,[28,[35,4],null,[["availableTags","tagId","onChange"],[[33,5],[33,6],[28,[37,7],[[30,0],"changeSelectedTag"],null]]]]],[1,"\\n"]],[]],null],[1,"    "],[1,[28,[35,8],null,[["class","value","placeholder"],["templates-filter",[33,9],[28,[37,10],["templates.filter_hint"],null]]]]],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"templates-list"],[12],[1,"\\n"],[42,[28,[37,12],[[28,[37,12],[[33,13]],null]],null],null,[[[1,"      "],[1,[28,[35,14],null,[["template","model","onInsertTemplate"],[[30,1],[33,15],[28,[37,7],[[30,0],"insertTemplate"],null]]]]],[1,"\\n"]],[1]],null],[1,"  "],[13],[1,"\\n"]],[]]]]]],["r"],false,["conditional-loading-spinner","loadingReplies","if","siteSettings","templates-tag-drop","availableTags","selectedTag","action","text-field","listFilter","i18n","each","-track-array","filteredReplies","template-item","model"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/components/templates-filterable-list.hbs",isStrictMode:!1})
e.default=i})),define("discourse/plugins/discourse-templates/discourse/templates/connectors/above-modal-header/discourse-templates-modal-hijacker",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=(0,t.createTemplateFactory)({id:"ncMBVfjo",block:'[[[41,[33,1],[[[1,"  "],[10,0],[14,0,"modal-header hijacked-modal-header"],[12],[1,"\\n    "],[8,[39,2],null,[["@icon","@class","@title","@action"],["angle-double-left","btn-flat modal-close close","templates.close_templates",[28,[37,3],[[30,0],"hide"],null]]],null],[1,"\\n    "],[10,0],[14,0,"title"],[12],[1,"\\n      "],[10,"h3"],[14,1,"discourse-modal-title"],[12],[1,[28,[35,4],["templates.insert_template"],null]],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"modal-body hijacked-modal-body discourse-templates discourse-templates-modal"],[12],[1,"\\n    "],[1,[28,[35,5],null,[["textarea","model","onBeforeInsertTemplate"],[[33,6],[33,7],[28,[37,3],[[30,0],"hide"],null]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],false,["if","active","d-button","action","i18n","templates-filterable-list","textarea","model"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/connectors/above-modal-header/discourse-templates-modal-hijacker.hbs",isStrictMode:!1})
e.default=i})),define("discourse/plugins/discourse-templates/discourse/templates/connectors/editor-preview/discourse-templates",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=(0,t.createTemplateFactory)({id:"srN336CL",block:'[[[41,[33,1],[[[1,"  "],[10,0],[14,0,"d-editor-preview"],[12],[1,"\\n    "],[1,[28,[35,2],null,[["class","action","icon"],["modal-close close btn-flat",[28,[37,3],[[30,0],"hide"],null],"times"]]]],[1,"\\n    "],[1,[28,[35,4],null,[["model","onAfterInsertTemplate"],[[33,5],[28,[37,3],[[30,0],"hide"],null]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],false,["if","templatesVisible","d-button","action","templates-filterable-list","model"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/connectors/editor-preview/discourse-templates.hbs",isStrictMode:!1})
e.default=i})),define("discourse/plugins/discourse-templates/discourse/templates/modal/discourse-templates-modal",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=(0,t.createTemplateFactory)({id:"ByxeGqwb",block:'[[[6,[39,0],null,[["title","class"],["templates.insert_template","discourse-templates discourse-templates-modal"]],[["default"],[[[[1,"  "],[1,[28,[35,1],null,[["textarea","model","onAfterInsertTemplate"],[[33,2],[33,3],[28,[37,4],[[30,0],"hide"],null]]]]],[1,"\\n"]],[]]]]]],[],false,["d-modal-body","templates-filterable-list","textarea","model","action"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/modal/discourse-templates-modal.hbs",isStrictMode:!1})
e.default=i})),define("discourse/plugins/discourse-templates/initializers/discourse-templates-add-ui-builder",["exports","discourse/lib/plugin-api","discourse/lib/show-modal"],(function(e,t,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s={name:"discourse-templates-add-ui-builder",initialize(e){const s=e.lookup("service:site-settings"),l=e.lookup("service:current-user")
s.discourse_templates_enabled&&l?.can_use_templates&&(0,t.withPluginApi)("0.5",(t=>{(function(e){e.modifyClass("controller:composer",{pluginId:"discourse-templates",actions:{showTemplatesButton(){this.site.mobileView?(0,i.default)("discourse-templates-modal"):(this.appEvents.trigger("composer:show-preview"),this.appEvents.trigger("discourse-templates:show"))}}})})(t),function(e){e.addToolbarPopupMenuOptionsCallback((()=>({id:"discourse_templates_button",icon:"far-clipboard",action:"showTemplatesButton",label:"templates.insert_template"})))}(t),function(e,t){const s=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"
e.addKeyboardShortcut(`${s}+shift+i`,(e=>{e.preventDefault()
const s=t.lookup("service:app-events"),l=document.activeElement,o=t.lookup("controller:composer").model,a=document.querySelector(".d-editor")
if(o&&a?.contains(l))return s.trigger("composer:show-preview"),s.trigger("composer-messages:close"),void s.trigger("discourse-templates:show")
if("TEXTAREA"===l?.nodeName){const e=document.querySelector(".d-modal")
if(e?.contains(l))s.trigger("discourse-templates:hijack-modal",{textarea:l})
else{const e=t.lookup("controller:discourse-templates-modal");(0,i.default)("discourse-templates-modal"),e.set("textarea",l)}}}),{global:!0,help:{category:"templates",name:"templates.insert_template",definition:{keys1:[s,"shift","I"],keysDelimiter:"plus"}}})}(t,e)}))}}
e.default=s})),define("discourse/plugins/discourse-templates/lib/apply-template",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.insertTemplateIntoComposer=function(e,t){let{templateTitle:i,templateContent:s}=t
const l=e.get("model")
l&&!l.title&&l.set("title",i)
e.appEvents.trigger("composer:insert-block",s)},e.prepareTemplate=function(e,t,i){if(i){const s={my_username:i.get("user.username"),my_name:i.get("user.name"),topic_title:i.get("topic.title"),topic_url:i.get("topic.url"),original_poster_username:i.get("topic.details.created_by.username"),original_poster_name:i.get("topic.details.created_by.name"),reply_to_username:i.get("post.username"),reply_to_name:i.get("post.name"),last_poster_username:i.get("topic.last_poster_username"),reply_to_or_last_poster_username:i.get("post.username")||i.get("topic.last_poster_username")}
for(let i in s)s[i]?(e=e.replace(new RegExp(`%{${i}(,fallback:.[^}]*)?}`,"g"),s[i]),t=t.replace(new RegExp(`%{${i}(,fallback:.[^}]*)?}`,"g"),s[i])):(e=(e=e.replace(new RegExp(`%{${i},fallback:(.[^}]*)}`,"g"),"$1")).replace(new RegExp(`%{${i}}`,"g"),""),t=(t=t.replace(new RegExp(`%{${i},fallback:(.[^}]*)}`,"g"),"$1")).replace(new RegExp(`%{${i}}`,"g"),""))}return{templateTitle:e,templateContent:t}}}))

//# sourceMappingURL=discourse-templates-fe637449123557648b7ef0c0ab19c1d0da38e25dd2e1c89eae850649d631e56b.map
//!

;
